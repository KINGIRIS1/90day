<analysis>
The AI engineer's work has significantly evolved the document classification system, primarily by enhancing the Gemini Flash AI integration and refining classification logic. Initially, the focus was on correct model naming () and expanding document type recognition. A major architectural shift occurred from a Smart Hybrid (crop-based retry) to a Position-Aware classification, where the AI analyzes the full image and classifies only if the title is in the top 30%, explicitly ignoring body mentions. Numerous bug fixes and prompt refinements were implemented to distinguish similar document types (e.g., GCNM vs. DDKBD, PKTHS vs. GTLQ, VBTK vs. TTHGD), handle references, and incorporate a Standalone Text Rule for titles. The attempt to detect handwritten page numbers for sequential naming was abandoned due to low reliability. The immediate task is to debug and fix the  issue.
</analysis>

<product_requirements>
The application is a desktop OCR scanner for Vietnamese land-related documents, designed for accurate classification and renaming using short codes. It supports single/batch scanning, history, PDF export, fuzzy matching, and keyword-based classification. Sequential documents require automatic title assignment for low-confidence or untitled scans. The app offers various OCR options: Tesseract, VietOCR, EasyOCR, and a Bring Your Own Key (BYOK) feature for Google Cloud Vision, Azure Computer Vision, and Gemini Flash. Cloud Boost (GPT-4 Vision) is available for high-accuracy fallback. Recent development refined classification to accurately identify GCNM continuation pages, differentiate similar document types like DDKBD, TTHGD, PCTSVC, PKTHS, and GTLQ, and distinguish main titles from body text references using Position-Aware and Standalone Text rules. A new feature request is Batch Scan from List using Excel/CSV.
</product_requirements>

<key_technical_concepts>
- **Electron**: Desktop application framework for UI and IPC.
- **React**: Frontend UI development.
- **Python**: Backend for OCR, rule-based classification, and AI integration.
- **Cloud OCR/AI**: Google Cloud Vision, Azure Computer Vision, Gemini Flash, GPT-4 Vision.
- **Pillow**: Python library for image manipulation.
- ****: Python library for HTTP API calls.
- **Position-Aware Classification**: AI prompt engineering to classify based on text location.
- **Standalone Text Rule**: Identifying titles by their isolated presentation.
</key_technical_concepts>

<code_architecture>


-   ****: Electron's main process, handles IPC and Python script execution. Updated Gemini Flash model name to  and increased OCR timeout.
-   ****: Production build of , synchronized with  changes.
-   ****: Gemini Flash AI OCR engine. This file saw the most significant changes.
    -   **Summary**: Updated to use . Initial crop logic (35% then 60%) was implemented and then reverted to 100% full image scanning to prioritize accuracy. The classification prompt was extensively refined to incorporate Position-Aware Classification (classifying only if the title is in the top 30% of the page), Standalone Text Rule (titles are on independent lines), and explicit differentiation logic for GCNM (continuation pages, distinguishing from DDKBD based on keywords like CƠ QUAN vs ỦY BAN NHÂN DÂN), TTHGD (expanded variants to include Phân chia tài sản hộ gia đình), PKTHS vs GTLQ (KIỂM TRA vs KIỂM SOÁT), and GTLQ (added VĂN BẢN KHAI NHẬN DI SẢN and PHIẾU BÁO). Error handling for JSON responses and increased API timeout were also implemented. Page number detection logic was added for testing but subsequently removed.
-   ****: Orchestrates document processing and OCR engine selection.
    -   **Summary**: The Smart Hybrid approach (35%/60% crop + retry) was removed in favor of a single 100% full image scan. Now leverages the  field from Gemini's response to validate classifications. Page number logging logic was temporarily added for testing, then removed.
-   ****: Contains rule-based classification logic. Updated for GTLQ, PCTSVC, TTHGD, and PKTHS keyword variants and error handling.
-   ****: Frontend component for scanning results. Added  to prevent  errors.
-   ****: Backend for Cloud Boost (OpenAI Vision). Synchronized with the GCNM continuation page logic and Standalone Text Rule implemented in .
-   **New Documentation Files**: , , , , , ,  (reverted).
</code_architecture>

<pending_tasks>
- Implement the full logic for the all-in-one installer using .
- Fine-tune remaining document types in .
- Monitor OpenAI quota/plan for Emergent LLM Key (if Cloud Boost is used).
- Migrate or pin React/Webpack versions.
- Test the backend with 5-10 real images to validate Hybrid OCR.
- Update icon for macOS (.icns).
- Implement license/activation key feature.
- Implement Parallel Local Processing for batch scanning.
- Handle deep path length issues in the application.
- Implement Batch Scan from List feature.
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was investigating a critical build issue reported by the user: bản build npm run electron-build ko hoạt động (the build  is not working). The engineer had just started to diagnose this problem by examining the  file in  and was about to check for issues with the  file in the  directory, which is crucial for the production build. This task is currently in the initial diagnostic phase, aimed at ensuring the application can be successfully built and deployed.
</current_work>

<optional_next_step>
Investigate and fix the  issue.
</optional_next_step>
