<analysis>
The AI engineer's work primarily focused on enhancing the desktop application's Vietnamese OCR and document classification capabilities. Key efforts included resolving a  in  and subsequently addressing various classification inaccuracies. A significant iteration involved implementing and then removing a Low Quality Title Detection Rule based on user feedback. The engineer then facilitated the integration of a Railway backend URL into the Electron app. Following this, extensive debugging of the classification engine ( and ) was performed, fixing issues where EasyOCR's output, including typos and reading order, led to incorrect title extraction and document classification. This involved refining regex patterns to be highly flexible with Vietnamese diacritics and character sequences, increasing image crop area for title detection, and strengthening logic to reject non-title text. The immediate next step involves improving the existing fuzzy matching approach to reduce reliance on strict regex patterns.
</analysis>

<product_requirements>
The application is a high-volume desktop document scanner for Vietnamese land-related images, designed for OCR and renaming using short codes. It supports single/batch scanning, history, and PDF export. Users require default Offline OCR (Tesseract) with an optional Cloud Boost (GPT-4 Vision). A Rules Manager for UI-driven classification and auto-generating keyword variants is needed. Core requirements included easy installation (all-in-one installer), improving  accuracy, port conflict resolution (dev server 3000 to 3001), and enhanced OCR with user selection among Tesseract, VietOCR, and EasyOCR. A critical need is accurate document classification (e.g., Hợp đồng chuyển nhượng vs. Căn cước công dân or Giấy ủy quyền), especially with OCR typos, addressed by fuzzy matching, case-aware scoring, and structured keyword prioritization. The application also needs robust handling of sequential documents where titles might be absent or of low quality.
</product_requirements>

<key_technical_concepts>
- **Electron**: Desktop application framework.
- **React**: Frontend UI development.
- **Python**: Backend for OCR and rule classification.
- **Tesseract, VietOCR, EasyOCR**: OCR engines.
- **NSIS**: Windows installer creation.
- **/**: Electron inter-process communication.
- **Fuzzy Matching**: Levenshtein distance for text similarity.
- **Regex**: Pattern matching for text extraction.
</key_technical_concepts>

<code_architecture>

- : The main Electron process script.
    - **Changes:** Updated to use  and  to manage the backend URL dynamically. It was updated to default to the Railway URL  for the Cloud Boost feature.
- : The packaged version of .
    - **Changes:** Received identical updates to handle the backend URL configuration.
- : Orchestrates local OCR and document processing.
    - **Changes:**
        - Fixed Unicode garbling by setting  and ensuring  uses  encoding on Windows.
        - Introduced  function to robustly find document titles using flexible regex patterns, prioritizing central titles over page headers, and accounting for various OCR typos and Vietnamese diacritics. This function is used to populate .
        - Expanded regex patterns for Vietnamese characters (E, O, U variations) and character sequences (e.g., ) within  to handle OCR inaccuracies more effectively.
        - Reordered title patterns to prioritize  over  to resolve classification conflicts.
- : Contains EasyOCR implementation.
    - **Changes:** Increased  for title detection from 25% to 35%, and then to 40% to capture titles that might be lower on the page, like ĐƠN ĐĂNG KÝ BIẾN ĐỘNG.
- : The core classification logic.
    - **Changes:**
        - Resolved .
        - Implemented and then reverted a Low Quality Title Detection Rule ( short code), which aimed to use sequential naming for low uppercase/low confidence titles.
        - Added templates for  (Hợp đồng ủy quyền).
        - Introduced  to remove common administrative headers before classification.
        - Modified  to set  if its uppercase ratio is below 70%, effectively ignoring non-uppercase titles for fuzzy matching. This prevents incorrect classifications like Giấy chứng nhận quyền sử dụng đất being mistaken for a true title on a continuation page.
        - Added  for potential debug warnings.
- : Frontend component handling document scanning.
    - **Changes:** Logic for handling the Low Quality Title Detection Rule ( flag) was added to  and then removed, reverting to the original sequential naming logic.
- : New documentation file detailing how to set up the backend on Railway and configure the desktop app.
- , , , , , , , : New documentation files explaining various fixes, rules, and comparisons.
</code_architecture>

<pending_tasks>
- Implement the full logic for the all-in-one installer using .
- Fine-tune remaining document types in .
- Monitor OpenAI quota/plan for Emergent LLM Key (if Cloud Boost is used).
- Migrate or pin React/Webpack versions.
- Test the backend with 5-10 real images to validate Hybrid OCR.
- Update icon for macOS (.icns).
- Implement license/activation key feature.
- Implement Parallel Local Processing for batch scanning.
</pending_tasks>

<current_work>
Immediately prior to this summary, the AI engineer was addressing a user-reported issue where HỢP ĐỒNG ỦY QUYỀN was incorrectly classified as HDCQ. This led to a detailed debugging process focusing on the  for title pattern extraction. The root causes identified were:
1.  Missing Vietnamese character variations (e.g.,  for ,  for ) in the regex character classes within .
2.  Complex character sequences like UỶ (composed of U and a separate diacritic Ỷ) were not correctly matched by simpler patterns.

The AI engineer implemented the following fixes in :
-   Expanded regex character classes for  to include all their Vietnamese diacritical variants (, ).
-   Refined the pattern for ỦY to  to handle various forms including , , , .
-   Ensured the order of  prioritizes more specific document types like  over potentially broader ones like  to prevent early, incorrect matches.

After these fixes, all specific test cases for HỢP ĐỒNG ỦY QUYỀN and its variations passed successfully. The current problem-solving trajectory, prompted by the user's frustration with constant pattern fixes for OCR typos, has shifted towards leveraging and improving the existing fuzzy matching capabilities in . The AI engineer has identified the relevant section in  to potentially adjust the fuzzy matching threshold, with the goal of making the classification system more resilient to OCR inaccuracies without requiring continuous regex updates.
</current_work>

<optional_next_step>
Reduce the fuzzy matching confidence threshold in  from 80% to 75% to improve flexibility with OCR typos.
</optional_next_step>
