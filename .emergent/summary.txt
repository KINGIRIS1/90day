<analysis>
The AI engineer's trajectory chronicles a complex evolution of the application from a web-only document scanner to a full-fledged Electron desktop app, with a continuous focus on optimizing OCR accuracy and stability for Vietnamese documents. Key challenges included navigating Windows-specific Python environment issues, diverse OCR engine compatibilities (Tesseract, PaddleOCR, VietOCR, RapidOCR, GPT-4 Vision), and Electron's IPC limitations. The core work involved implementing sequential naming, developing font height detection for title prioritization, and iteratively expanding/refining a 95-type rule-based classification system with typo variants. After repeated failures with local deep-learning OCR engines due to compatibility and verbose logging, the project pivoted towards integrating a robust cloud-based solution, culminating in the decision to use Google Document AI as the next step.
</analysis>

<product_requirements>
The application, originally a web-based document scanner for Vietnamese land-related images, aims to use LLMs for OCR and automated renaming with short codes. It supports single/batch scanning, history, and PDF export, targeting 30 concurrent users. Key objectives include LLM stability, enhanced folder scanning (), performance, deployment reliability, and cost optimization via a hybrid OCR (initially PaddleOCR + rules with GPT-4 fallback).

The user explicitly requested a **Hybrid Desktop App** with two modes:
1.  **Default: OCR+Rules (Offline)**: Free, aiming for 85-88% accuracy. The AI engineer initially implemented this using Tesseract, scanning the top 40% of documents, and a comprehensive rule classifier (supporting 95 document types with diacritic and diacritic-less keywords).
2.  **Optional: Cloud Boost (Online)**: Paid, leverages GPT-4 for higher accuracy (93%+).
The user also required **sequential naming logic** for multi-page documents to classify UNKNOWN pages based on preceding pages.
Subsequently, the user requested the ability to detect **bold/large text for title prioritization**, a **debug view to display raw OCR text**, and a **better Vietnamese OCR tool** (leading to explorations of PaddleOCR, VietOCR, RapidOCR, and now Google Document AI) to enhance accuracy and reduce misclassifications, especially for diacritics.
</product_requirements>

<key_technical_concepts>
-   **Full-stack Desktop Development**: Electron (frontend), React (UI), Python (local OCR/processing).
-   **OCR Engines**: Tesseract, PaddleOCR, VietOCR, RapidOCR, OpenAI GPT-4 Vision, Google Document AI.
-   **AI/LLM Integration**: GPT-4 Vision for Cloud Boost, rule-based classification.
-   **Inter-process Communication (IPC)**: Electron's /.
-   **Rule-based Classification**: Custom Python module for Vietnamese document typing.
-   **Environment/Deployment**: Windows OS compatibility (Python, Tesseract, PaddleOCR dependencies), , .
</key_technical_concepts>

<code_architecture>

-   : Handles web API requests, including the  endpoint for desktop app, utilizing  (3-layer fallback: OCR+Rules -> GPT-4 -> OCR+Rules Backup) to reduce UNKNOWN classifications.
-   : Manages Electron/React dependencies and scripts. Updated for  to use  or  for .
-   : Electron's main process. Implemented , ,  IPC handlers. Updated Python execution path for Windows. Enhanced stderr handling to log verbose output without failing IPC, and added a 30s timeout for OCR.
-   : Secure bridge for Electron's main/renderer processes. Exposes  with file selection, OCR processing, and URL management.
-   : Orchestrates local OCR. Modified to prioritize different OCR engines (PaddleOCR, VietOCR, RapidOCR successively, with Tesseract as fallback). Handles ,  for file paths, passes  to the classifier, and includes environment variables to suppress PaddlePaddle logs. Fixed an OCREngine not defined error during RapidOCR integration.
-   : Tesseract OCR logic. Created and implemented top 40% image cropping, Tesseract executable auto-location, and logic to extract font height. Currently serves as the fallback OCR engine.
-   : (NEW FILE) Created for PaddleOCR integration. Attempts were made to suppress verbose logging.
-   : (NEW FILE) Created for VietOCR integration.
-   : (NEW FILE) Created for RapidOCR integration, aiming for high speed and clean output.
-   : (Previously ) Comprehensive rule-based classifier for 95 Vietnamese document types. Updated with title priority scoring (2x weight for title keywords, 20% confidence boost), common OCR typo variants (giầy, chứng nhan, NHUQNG), and auto-enhanced 88 types with uppercase variants via . Weights adjusted for DDKBD, CCCD, HDCQ.
-   : Main UI for desktop scanning. Integrates /, Test Both functionality, and  logic for multi-page documents. Recently updated to include a **debug view for raw OCR text**.
-   : (NEW FILE) Displays side-by-side OCR results. Recently updated to include a **debug view for raw OCR text**.
-   : (NEW FILE) Helper script to add keyword variants.
-   : (NEW FILE) Script to automatically enhance all document type keywords with uppercase and typo variants.
-   : (NEW FILE) Backup of the  before batch enhancements.
-   , , : (NEW FILES) Installation and troubleshooting guides for PaddleOCR and VietOCR.
</code_architecture>

<pending_tasks>
-   Monitor OpenAI quota/plan or balance for Emergent LLM Key.
-   Consider adding  to .
-   Migrate or pin React/Webpack versions to address peer dependency warnings.
-   Test the backend with 5-10 real images to validate the integrated Hybrid OCR.
-   Test the desktop app with multi-page documents to validate the sequential naming logic.
-   Fine-tune remaining document types in .
</pending_tasks>

<current_work>
Immediately before this summary request, the AI engineer was addressing the user's need for a superior Vietnamese OCR tool, specifically one that could handle diacritics better and provide reliable output for the desktop application. This involved an iterative process of:
1.  **Attempting PaddleOCR integration**: This failed due to  in the ARM64 container and later  compiler requirements on the user's Windows machine, along with unsuppressable C++ logs breaking Electron IPC.
2.  **Attempting VietOCR integration**: This failed due to corrupt model file downloads ().
3.  **Attempting RapidOCR integration**: While initially promising for speed, it failed to accurately recognize Vietnamese diacritics, leading to misclassifications.
Due to these failures and the need for a stable, accurate solution, the conversation pivoted to evaluating **Google Document AI**. The AI engineer performed a comprehensive comparison of Google Document AI with other OCR engines, highlighting its high accuracy (~98%), excellent Vietnamese diacritics support, and cost-effectiveness (.50/1k pages). The user then explicitly decided to proceed with Google Document AI. The current immediate work involves calling the  agent to obtain the necessary playbook for integrating Google Document AI.
</current_work>

<optional_next_step>
Process the integration playbook received from the  agent for Google Document AI and implement the integration.
</optional_next_step>
